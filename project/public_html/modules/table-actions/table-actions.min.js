!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e||self).TableActions=t()}(this,function(){function e(e,t){void 0===t&&(t=[]);const a=document.createElement(e);return t.length&&a.classList.add(...t),a}function t(t,a){void 0===a&&(a={});let n=e(t,(a=o({classList:[],label:"",nodeToAppend:void 0,disabled:!1,prependEl:void 0,outsideElement:{element:void 0,classList:[]},datasets:{}},a)).classList);"input"===t?n.placeholder=a.label:n.innerHTML=a.label;const s=Object.values(a.datasets);if(s.length)for(const e of s)n.dataset[e.name]=e.value;if(n.disabled=a.disabled,a.outsideElement&&a.outsideElement.element){const t=e(a.outsideElement.element,a.outsideElement.classList);t.appendChild(n),n=t}return a.prependEl?a.nodeToAppend.insertBefore(n,a.prependEl):a.nodeToAppend.appendChild(n)}function a(e){const t={};for(const o in e)if(e.hasOwnProperty(o)){const n=e[o];t[o]=Array.isArray(n)?n.concat():"object"==typeof n&&null!==n?a(n):n}return t}function o(e,t){let n=a(e);for(const e of Object.keys(t)){let a=t[e],s=n[e];n[e]=Array.isArray(a)&&Array.isArray(s)?a.concat(...s):null!==a&&"object"==typeof a&&null!==s&&"object"==typeof s?o(s,a):a}return n}return class{constructor(e,t){void 0===t&&(t={}),this.table="string"==typeof e?document.querySelector(e):e,this.taResponsiveContainer=[...this.table.parentNode.classList].includes("ta-responsive-full-width"),this.tableContainer=this.taResponsiveContainer?this.table.parentNode.parentNode:this.table.parentNode,this.dataJson=t.data,this.options={searchable:t.searchable||!0,sortable:t.sortable||!0,paginable:t.paginable||"buttons",rowsPerPage:t.rowsPerPage||10,checkableRows:t.checkableRows||!1,checkableRowTrReference:t.checkableRowTrReference||"data-row-id",alreadyAddedElements:t.alreadyAddedElements,checkedElementsCallback:t.checkedElementsCallback||function(e){console.log(e)},checkableButtonLabel:t.checkableButtonLabel||"Interact"},this._init()}_init(){this.dataJson&&this._populateTableFromJson(this.dataJson),this.tableRows=[...this.table.querySelector("tbody").querySelectorAll("tr")],this.hasPages=this._lastPage()>1,this.currentPage=1;const e=this.options.checkableRows;t("div",{classList:["ta-bottom-div"],label:"",nodeToAppend:this.tableContainer}),e&&this._tableCheckBoxes(),this.options.sortable&&this._tableSort(e),this.options.paginable&&this.hasPages&&(this._paginationButtons(),this._updateTable()),this._mobileTableLabels(),this.options.searchable&&this._searchField()}_populateTableFromJson(a){const o=e("thead"),n=e("tbody");let s=e("tr");this.table.appendChild(o),this.table.appendChild(n);for(const e of a.headings)t("th",{label:e.label,nodeToAppend:s,datasets:[{name:"type",value:e.type}]});let l=a.headings.findIndex(e=>e.name===a.rowIdField);this.options.checkableRows&&l>0?l-=1:l=0,o.appendChild(s);for(const o of[...a.data]){s=e("tr");for(const e of o)t("td",{label:e,nodeToAppend:s});s.dataset.rowId=o[l],n.appendChild(s)}}_searchField(){const a=this;a.defaultStateTableRows=[...a.tableRows],t("input",{label:"Pesquisa",nodeToAppend:this.tableContainer,prependEl:this.taResponsiveContainer?this.table.parentNode:this.table,outsideElement:{element:"div",classList:["ta-search-container"]}}).addEventListener("keyup",function(){const t=this.querySelector("input").value,o=[];let n=a.table.querySelector("th>[type='checkbox']");if(n&&(n.disabled=!1),a.tableRows=a.defaultStateTableRows,t.length>2){a.options.paginable&&(a.currentPage=1);for(const e of a.tableRows){const t=e.querySelectorAll("td");for(const a of t){let t=a.innerHTML;const n=a.querySelector("a");if(n&&(t=n.innerHTML),t.trim().toLowerCase().startsWith(this.querySelector("input").value.toLowerCase())){o.push(e);break}}}if(!o.length){const t=e("tr"),s=e("td",["ta-td-message"]);s.dataset.label="Message",s.colSpan=a.table.querySelectorAll("th").length,s.innerHTML="Nenhum elemento a ser exibido",t.appendChild(s),o.push(t),n&&(n.disabled=!0)}a.tableRows=o}a._updateTable(),a._butonCheckableRowsUpdate()})}_paginationButtons(){const e=this,a=e.tableContainer.querySelector(".ta-bottom-div");t("button",{classList:["ta-btn","ta-btn-pag-jump","back-all-pages"],label:"&lt;&lt;",nodeToAppend:a}).addEventListener("click",function(){e.currentPage>1&&(e.currentPage=1,e._updateTable())}),t("button",{classList:["ta-btn","ta-btn-pag","backward-page"],label:"&lt;",nodeToAppend:a}).addEventListener("click",function(){e.currentPage>1&&(e.currentPage=e.currentPage-=1,e._updateTable())}),"list"===this.options.paginable?t("div",{classList:["ta-numbered-buttons"],nodeToAppend:a}):"buttons"===this.options.paginable&&t("div",{classList:["ta-paginable-pages"],nodeToAppend:a}),t("button",{classList:["ta-btn","ta-btn-pag","forward-page"],label:"&gt;",nodeToAppend:a}).addEventListener("click",function(){e.currentPage<e._lastPage()&&(e.currentPage=e.currentPage+=1,e._updateTable())}),t("button",{classList:["ta-btn","ta-btn-pag-jump","forward-all-pages"],label:"&gt;&gt;",nodeToAppend:a}).addEventListener("click",function(){e.currentPage<e._lastPage()&&(e.currentPage=e._lastPage(),e._updateTable())})}_mobileTableLabels(){const e=this,t=this.table.querySelectorAll("th");for(const a of e.tableRows)for(const[o,n]of t.entries())a.querySelectorAll("td")[o].dataset.label=0===o&&e.options.checkableRows?"Checkbox":n.innerHTML}_buttonsOnlyPagination(){this.tableContainer.querySelector(".ta-paginable-pages").innerHTML=`${this.currentPage} - ${this._lastPage()}`}_numberedListPagination(){const e=this,a=this._lastPage(),o=this.currentPage;e.tableContainer.querySelector(".ta-numbered-buttons").innerHTML="";for(let n=0;n<a;n++){const s=n+1,l=[o-2,o+2],r=[o-1,o+1,...l],i=s>4&&s<a-1;let c=s;if(a>8){if(i&&s!==o&&!r.includes(s))continue;[...l,o+3].includes(s)&&s>3&&s<a-1&&(c="...")}t("button",{classList:["ta-btn","ta-btn-pag-numbered",`page-${s}`],label:c,nodeToAppend:e.tableContainer.querySelector(".ta-numbered-buttons")}).addEventListener("click",function(){e.currentPage=s,e._updateTable()})}}_tableCheckboxInsert(e,t,a){void 0===t&&(t=[]),void 0===a&&(a=!1);const o=document.createElement(e),n=document.createElement("input");return t.length&&o.classList.add(...t),a&&(n.checked=!0,n.disabled=a,n.title="Objeto já está adicionado"),n.type="checkbox",o.appendChild(n),o}_tableCheckBoxes(){const e=this,a=this.options.alreadyAddedElements,o=e.table.querySelectorAll("tbody>tr");e.table.querySelector("thead>tr").prepend(this._tableCheckboxInsert("th",["ta-checkbox-column"]));for(const t of o){let o;o=a&&a.includes(t.dataset.rowId)?e._tableCheckboxInsert("td",["ta-checkbox-row"],!0):e._tableCheckboxInsert("td",["ta-checkbox-row"]),t.prepend(o)}const n=t("button",{classList:["ta-btn","interact"],label:e.options.checkableButtonLabel,nodeToAppend:e.tableContainer.querySelector(".ta-bottom-div"),disabled:!0});n.addEventListener("click",function(){try{const t=[];for(const a of e.tableRows){const o=a.querySelector("[type='checkbox']");o.checked&&!o.disabled&&t.push(a.getAttribute(e.options.checkableRowTrReference))}const a=function(){if(void 0!==e.options.checkedElementsCallback&&"function"==typeof e.options.checkedElementsCallback)return Promise.resolve(e.options.checkedElementsCallback(t)).then(function(t){for(const a of o)t&&t.includes(a.getAttribute(e.options.checkableRowTrReference))&&(a.querySelector("input").disabled=!0)})}();return Promise.resolve(a&&a.then?a.then(function(){}):void 0)}catch(e){return Promise.reject(e)}});var s=document.querySelectorAll("[type='checkbox']");for(const t of s)t.addEventListener("click",function(t){if(t.target.closest("thead"))if(t.target.checked){for(const t of e.tableRows){const e=t.querySelector("[type='checkbox']");e.checked=!0,e.closest("tr").classList.add("checked")}n.disabled=!1}else{for(const t of e.tableRows){const e=t.querySelector("[type='checkbox']");e.checked=!1,e.closest("tr").classList.remove("checked")}n.disabled=!0}else e.table.querySelector("thead [type='checkbox']").checked=!1,t.target.closest("tr").classList.toggle("checked"),e._butonCheckableRowsUpdate()})}_butonCheckableRowsUpdate(){this.options.checkableRows&&(this.tableContainer.querySelector(".interact").disabled=!this.tableRows.find(e=>e.querySelector("[type='checkbox']:checked")))}_tableSort(e){const t=this;this.table.classList.add("sortable");const a=this.table.querySelectorAll("th");for(let o=e?1:0;o<a.length;o++){const e=a[o];if(null!=e.dataset.unsortable)continue;const n=[];for(const[e,t]of a.entries())e!==o&&n.push(t);e.addEventListener("click",function(){t._sortTable(e,o,n)})}}_dateStringTransform(e){const t=e.split("/");return t[2]+"-"+t[1]+"-"+t[0]}_sortDataFormat(e,t){const a=this;let o,n,s=t.trim(),l="";switch(e){case"DD/MM/YYYY":l=new Date(a._dateStringTransform(s));break;case"YYYY/MM/DD":l=new Date(s.replace("/","-"));break;case"YYYY-MM-DD":l=new Date(s);break;case"DD/MM/YYYY HH:MM":[o,n]=s.split(" "),l=new Date(a._dateStringTransform(o)+"T"+n+":00");break;case"YYYY-MM-DD HH:MM:SS":[o,n]=s.split(" "),l=new Date(o+"T"+n);break;case"currency-real":case"numeric(15, 2)":l=+s.replace(/[\.\,R\$\s]/g,"");break;default:l=a._genericSortDataFormat(s)}return l}_genericSortDataFormat(e){let t=e.replace(/[\.\,\;\s\n]/g,"").toLowerCase();return isNaN(t)?t.normalize("NFD").replace(/[\u0300-\u036f]/g,""):parseFloat(t)}_sortTable(e,t,a){const o=this,n=!e.dataset.asc||!JSON.parse(e.dataset.asc),s=e.dataset.format||e.dataset.type;for(const e of a)e.removeAttribute("data-asc");o.tableRows.sort(function(e,a){return e=e.querySelectorAll("td")[t].innerHTML,a=a.querySelectorAll("td")[t].innerHTML,s?(e=o._sortDataFormat(s,e),a=o._sortDataFormat(s,a)):(e=o._genericSortDataFormat(e),a=o._genericSortDataFormat(a)),n&&e>a||!n&&e<a?1:n&&e<a||!n&&e>a?-1:0}),o._updateTable(),e.dataset.asc=n}_currenRow(){return this.options.rowsPerPage*(this.currentPage-1)}_lastRow(){return this._currenRow()+this.options.rowsPerPage}_lastPage(){return Math.ceil(this.tableRows.length/this.options.rowsPerPage)}_updateTable(){const e=this,t=e.table.querySelector("tbody");if(t.innerHTML="",e.options.paginable){for(let a=e._currenRow();a<e._lastRow()&&a<e.tableRows.length;a++)t.appendChild(e.tableRows[a]);"list"===this.options.paginable&&this.hasPages?(e._numberedListPagination(),e._updateButtonsNumbered()):"buttons"===this.options.paginable&&this.hasPages&&(e._buttonsOnlyPagination(),e._forwardBackwardbuttons())}else for(const a of e.tableRows)t.appendChild(a)}_forwardBackwardbuttons(){const e=this;e.currentPage===e._lastPage()?(e.tableContainer.querySelector(".forward-page").disabled=!0,e.tableContainer.querySelector(".forward-all-pages").disabled=!0):(e.tableContainer.querySelector(".forward-page").disabled=!1,e.tableContainer.querySelector(".forward-all-pages").disabled=!1),1===e.currentPage?(e.tableContainer.querySelector(".backward-page").disabled=!0,e.tableContainer.querySelector(".back-all-pages").disabled=!0):(e.tableContainer.querySelector(".backward-page").disabled=!1,e.tableContainer.querySelector(".back-all-pages").disabled=!1)}_updateButtonsNumbered(){this._forwardBackwardbuttons();const e=this.tableContainer.querySelector(".ta-btn-pag-numbered:disabled");e&&(e.disabled=!1),this.tableContainer.querySelector(`.page-${this.currentPage}`).disabled=!0}}});
